/*
 * Trackiffer v0.2.2
 * Easy GA event tracking and debugging
 * https://github.com/averyvery/trackiffer
 *
 * Copyright 2011, Doug Avery
 * Dual licensed under the MIT and GPL licenses.
 * Uses the same license as jQuery, see:
 * http://jquery.org/license
 *
 * Should be compressed with http://jscompress.com/
 */

;
(function(a,b){"use strict";var c={version:"0.2.2",is_oldbrowser:navigator.userAgent.indexOf("MSIE 6")!=-1||navigator.userAgent.indexOf("MSIE 7")!=-1,jquery:{min_version:"1.4.0",loaded:false},tracked_elems:{},event_types:{form:"submit",select:"change","input[type=text]":"blur"},defineGa:function(){b._gaq=b._gaq||[]},init:function(){c.defineGa();c.checkHash();c.checkjQuery()},rules:{},loadScript:function(b){c.log("|    loading "+b);var d=a.createElement("script"),e=a.getElementsByTagName("script")[0];d.type="text/javascript";d.src=b;e.parentNode.insertBefore(d,e)},checkjQuery:function(){c.log("");c.log("+ checking for jQuery");if(c.isjQueryVersionHighEnough()===false){c.log("|    jQuery version too low");c.loadScript("http://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js");c.polljQueryVersion()}else{c.log("|    jQuery present");c.jquery.loaded=true;c.bindRules()}},normalizeVersion:function(a){var b=a+"",c=b.replace(/\./g,"");while(c.length<3){c=c+"0"}return parseInt(c,10)},isjQueryVersionHighEnough:function(){var a=typeof b.jQuery==="function"&&jQuery.fn.jquery||"0",d=c.normalizeVersion(a),e=c.normalizeVersion(c.jquery.min_version),f=d>e;f||c.log("|    wrong version: "+a+" (needs to be > "+c.jquery.min_version+")");return f},polljQueryVersion:function(){c.log("|    waiting 100ms");c.isjQueryVersionHighEnough()?c.jQueryHasLoaded():setTimeout(c.polljQueryVersion,100)},jQueryHasLoaded:function(){c.log("|    loaded jQuery");c.jquery.loaded=true;jQuery.noConflict();c.bindRules()},formatData:function(a,b){var d=c.parseTokens(a,b);d.unshift("_trackEvent");return d},getReplacement:function(a,b){var c;if(a){switch(a){case"#VALUE#":c=b.val();break;case"#TEXT#":c=b.text();break;default:var d=a.replace(/\#/g,"").toLowerCase();c=b.attr(d)}return c}},parseTokens:function(a,b){for(var d=0,e=a.length;d<e;d++){var f=a[d],g,h=d!==3;if(typeof f==="function"){f=f(b)}else if(h){var i=/#.+?#/g,j=f.match(i),k,l;if(j){for(var m=0,n=j.length;m<n;m++){k=c.getReplacement(j[m],b);if(k){l=jQuery.trim(k);f=f.replace(i,l)}}}}g=c.replaceBadCharacters(f);a[d]=g}return a},replaceBadCharacters:function(a){if(a.replace){a=a.replace(/,/g,"\\,");a=a.replace(/"/g,'\\"');a=a.replace(/'/g,"\\'")}return a},isDestinationOutbound:function(a){var c=a.attr("href")||a.attr("action"),d=false;if(c){var e=b.location.host,f=c.match("mailto:"),g=f!==null,h=c.match(/\.(?:doc|eps|jpg|png|svg|xls|ppt|pdf|xls|zip|txt|vsd|vxd|js|css|rar|exe|wma|mov|avi|wmv|mp3)($|\&|\?)/),i=h!==null,j=c.match(e),k=j===null;d=k||g||i}return!!d},executeDelayedAction:function(a,d){var e=d.get(0);if(c.debugging!==true){d.trigger(a);e.submit&&e.submit();if(a==="click"&&d.hasClass("nofollow")===false){b.location=d[0].href}}},delayAction:function(a,b,d){a.preventDefault();var e=function(){c.log("|    outbound event - firing after 100ms");c.executeDelayedAction(b,d)};c.debugging||d.unbind(b+".trackiffer");setTimeout(e,100)},trackRules:function(a){c.rules=a;c.jquery.loaded?c.bindRules():c.log("|    delaying init until jQuery loads")},bindRules:function(){c.log("");c.log("+  binding rules");for(var a in c.rules){if(c.rules.hasOwnProperty(a)){c.bindRulesToSelector(a)}}c.debugging&&c.highlightAllElements();c.rules={}},bindRulesToSelector:function(a){var b=jQuery(a);b.each(function(d){d===0&&c.log("|    "+b.length+"x "+a);c.bindEvent(c.rules[a],jQuery(this),a)})},getEventType:function(a){var b="click";for(var d in c.event_types){if(c.event_types.hasOwnProperty(d)){if(a.is(d)){b=c.event_types[d]}}}return b},bindEvent:function(a,d,e){var f=c.getEventType(d),g=function(h){c.log("");c.log("+  "+f+" on "+e);var i=c.formatData(a.slice(0),d),j=c.isDestinationOutbound(d);c.log("|    parsing ",a);c.log("v    ");b._gaq.push(i);c.log("^    ");if(j){c.log("|    outbound event - delaying");c.delayAction(h,f,d,g)}else if(c.debugging){return false}};c.bindDebugHover(a,d,e);d.bind(f+".trackiffer",g)},debugging:false,debug_outlines:{highlight:"rgb(0,200,200) 3px solid",hover:"rgb(250,0,0) 3px solid"},checkHash:function(){c.debugging=b.location.hash==="#trackiffer_debug";c.debugging&&c.debug()},log:function(){if(c.debugging&&typeof console==="object"&&console.log){var a=Array.prototype.slice.call(arguments);a.unshift("");console.log.apply(console,a)}},undefineGa:function(){c.log("|    unsetting existing GA");b._gat=undefined;b._gaq=[["_setAccount","UA-00000000-1"]]},debug:function(){c.debugging=true;c.log("+  debug mode");c.undefineGa();c.loadScript("http://www.google-analytics.com/u/ga_debug.js");c.debug_outlines.property=c.is_oldbrowser?"border":"outline";c.highlightAllElements();jQuery(b).keydown(c.leaveDebugIfEsc)},undebug:function(){c.debugging=false;c.log("+  leaving debug mode");c.unHighlightAllElements()},highlightAllElements:function(){c.actOnAllElements(c.highlightElement)},unHighlightAllElements:function(){c.actOnAllElements(c.unHighlightElement)},actOnAllElements:function(a){for(var b in c.tracked_elems){if(c.tracked_elems.hasOwnProperty(b)){jQuery.each(c.tracked_elems[b],a)}}},unHighlightElement:function(){jQuery(this).css(c.debug_outlines.property,"")},highlightElement:function(){jQuery(this).css(c.debug_outlines.property,c.debug_outlines.highlight)},hoverElement:function(){jQuery(this).css(c.debug_outlines.property,c.debug_outlines.hover)},bindDebugHover:function(a,b,d){var e=function(){c.debugging&&c.tracked_elems[d].each(c.hoverElement)},f=function(){c.debugging&&c.tracked_elems[d].each(c.highlightElement)};if(typeof c.tracked_elems[d]==="undefined"){c.tracked_elems[d]=jQuery()}c.tracked_elems[d]=c.tracked_elems[d].add(b);b.hover(e,f)},leaveDebugIfEsc:function(a){a.keyCode===27&&c.undebug()}};b.trackiffer=function(a){var b=typeof a==="object",d=typeof c[a]==="function",e=c;if(b){c.trackRules(a)}else if(d){e=c[a]()}else if(a){e=c[a]}return e};c.init()})(document,window)
;
