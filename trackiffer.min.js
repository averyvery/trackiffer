/*
 * Trackiffer v0.1.6
 * Easy GA event tracking and debugging
 * https://github.com/averyvery/trackiffer
 *
 * Copyright 2011, Doug Avery
 * Dual licensed under the MIT and GPL licenses.
 * Uses the same license as jQuery, see:
 * http://jquery.org/license
 *
 * Edit the tracking rules to create simple click-based event trackers for GA events.
 * At any time, you can visit a page in your browser and paste this code into the console to test.
 * Add this script at the verrrry bottom of a site to start tracking.
 *
 * Should be compressed with http://jscompress.com/
 */

(function(a,b){function G(a,b,c){var e=A(b),f=function(c){var g=u(a.slice(0),b),h=B(b);_gaq.push(g);if(h){m("Delaying outbound action...");z(c,e,b,f)}else if(d){return false}};F(a,b,c);b.bind(e+".trackiffer",f)}function F(a,b,c){var f=function(){d&&i[c].each(C)},g=function(){d&&i[c].each(D)};if(typeof i[c]==="undefined"){i[c]=jQuery()}i[c]=i[c].add(b);d&&b.css(e);b.hover(f,g)}function E(){for(var a in i){$.each(i[a],D)}}function D(){$(this).css(e)}function C(){$(this).css(f)}function B(a){var b=location.host!==""||"localhost",c=a.attr("href")||a.attr("action")||"",d=c.indexOf(b)==-1&&c.match(/^http/i);return!!d}function A(a){var b="click";for(var c in j){if(a.is(c)){b=j[c]}}return b}function z(a,b,c){a.preventDefault();var d=function(){y(b,c)};c.unbind(b+".trackiffer");setTimeout(d,100)}function y(a,c){var e=c.get(0);m("Firing delayed "+a+"!");if(d!==true){c.trigger(a);e.submit&&e.submit();if(a==="click"&&c.hasClass("nofollow")===false){b.location=c[0].href}}}function x(a){a=a.replace(/,/g,"\\,");a=a.replace(/"/g,'\\"');a=a.replace(/'/g,"\\'");return a}function w(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(typeof e==="function"){e=e(b)}else{var f=/#.+?#/,g=e.match(f),h,i;i=jQuery.trim(v(g,b));if(i){e=e.replace(f,i)}}e=x(e);a[c]=e}return a}function v(a,b){if(a){switch(a[0]){case"#VALUE#":replacement=b.val();break;case"#TEXT#":replacement=b.text();break;default:attribute=a[0].replace(/\#/g,"").toLowerCase();replacement=b.attr(attribute)}return replacement}}function u(a,b){a=w(a,b);a.unshift("_trackEvent");return a}function t(a){if(h){for(selector in a){jQuery(selector).each(function(){G(a[selector],$(this),selector)})}}else{m("Delaying bind until jQuery loads...");k=function(){t(a)}}}function s(b){m("Loading "+b);var c=a.createElement("script"),d=a.getElementsByTagName("script")[0];c.type="text/javascript";c.src=b;d.parentNode.insertBefore(c,d)}function r(){m("jQuery has loaded!");h=true;k()}function q(){p()?r():setTimeout(q,100)}function p(){version=b.jQuery&&jQuery.fn.jquery||"0";m("Checking jQuery version: "+version+" (needs to be 1.4+)");version=o(version);if(version>140){g=true}return g}function o(a){var a=a+"";a=a.replace(/\./g,"");while(a.length<3){a=a+"0"}return parseInt(a)}function n(){p()||s("http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js");q()}function m(){if(d&&typeof console==="object"&&console.log){var a=Array.prototype.slice.call(arguments);a.unshift("---");console.log.apply(console,a)}}function l(){n()}function k(){}var c={version:function(){return"0.1.6"}},d=a.location.hash==="#trackiffer_debug",e={outline:"rgba(0,200,200,.35) 3px solid"},f={outline:"rgba(250,0,0,.7) 3px solid"},g=false,h=false,i={},j={form:"submit",select:"change","input[type=text]":"blur"};c.debug=function(){d=true;m("Trackiffer entering debug mode.");m("Tracked links WILL NOT WORK and WILL NOT TRACK while in debug mode.");_gat=undefined;_gaq=[["_setAccount","UA-00000000-1"]];s("http://www.google-analytics.com/u/ga_debug.js");E()};c.undebug=function(){d=false};c.version=function(){return version};b.trackiffer=function(a){typeof a==="object"?t(a):c[a]()};l();d&&c.debug()})(document,window)
